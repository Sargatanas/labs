<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Длинная арифметика</title>

    <meta name="description"
          content="На этой странице содержатся данные по арифметике длинных чисел на Pascal">
    <meta name="keywords" content="длинные числа, Pascal">

    <link rel="stylesheet" href="css/style_2.css">
</head>
<body>
    <div id="top"></div>
    <div class="main">
        <h1>
            ЗАДАЧИ НА ДЛИННУЮ АРИФМЕТИКУ
        </h1>

        <h2>
            Оглавление
        </h2>
        <ul class="ul">
            <li>
                <a href="#intro">Введение</a>
            </li>
            <li>
                <a href="#main">Основная часть</a>
            </li>
            <li>
                <a href="#conclusion">Заключение</a>
            </li>
            <li>
                <a href="#tasks">Задачи для самостоятельного решения</a>
            </li>
            <li>
                <a href="#literature">Список литературы</a>
            </li>
            <li>
                <a href="#analogy">Сайты аналогичной тематики</a>
            </li>
        </ul>

        <p>
            <u>Примечание</u>: при нажатии на солнышко или луну перейдешь наверх
        </p>


        <hr class="hr_1">

        <h2 id="intro">
            Введение
        </h2>

        <a href="#top">
            <img class="img day" src="img/img2.png">
            <img class="img night" src="img/img3.png" style="width: 80px;">
        </a>

        <p>
            Рассмотрим достаточно популярную в программировании задачу на работу с "длинными" числами. Реально с
            "астрономическими" или "микроскопическими" числами приходится сталкиваться не так уж и часто. Тем не менее,
            упражнения, рассматриваемые в этой публикации, могут послужить хорошей тренировкой в области программирования
            и занять достойное место в классах с углубленным изучением информатики или на кружках по программированию.
            Алгоритмы, представленные ниже, записаны на Turbo Pascal, версия&nbsp;7.0. При желании или необходимости они
            могут легко быть адаптированы к любой другой программной среде.
        </p>

        <p>
            Диапазон представления целых чисел (<b>Integer, Word, LongInt</b>) ограничен, о чем не раз уже
            говорилось (впрочем, для действительных величин это замечание тоже актуально). Поэтому при решении задач
            всегда приходится действовать с оглядкой, — как бы не допустить возникновения ошибки выхода за диапазон или
            переполнения. Например, вычисляя факториал (<i>n</i>!&nbsp;=&nbsp;1&nbsp;*&nbsp;2&nbsp;*&nbsp;3&nbsp;*&nbsp;…&nbsp;*&nbsp;<i>n</i>), в диапазоне представления
            величин типа <span style="font-family: 'Courier New', monospace;">Integer</span> удастся правильно получить
            только 7!&nbsp;=&nbsp;5040, а в  диапазоне представления типа
            <span style="font-family: 'Courier New', monospace;">LongInt</span> — 12!&nbsp;=&nbsp;479001600. Для больших значений,
            конечно, можно использовать действительные типы данных, но это уже не гарантирует точного результата. Поэтому
            полезно для получения точных значений при действиях с многозначными числами разработать другие способы
            представления таких чисел, алгоритмы выполнения арифметических и других операций, процедуры ввода и вывода
            результатов и т.д.
        </p>

        <p>
            Покажем реализацию решения такого рода задач на примере умножения одного многозначного числа на другое. Именно
            эта арифметическая операция наиболее часто используется при решении других задач.
        </p>

        <h2 id="main">
            Основная часть
        </h2>

        <p class="text">
            Наиболее естественным способом представления многозначного числа является запись каждого его разряда в виде
            отдельного элемента линейного массива (или списка, где память под цифру будет отводиться по мере надобности,
            в то время как в массиве приходится заранее задавать максимальное количество элементов в нем). Пусть
            (для удобства дальнейших действий) разряды "длинного" числа при записи в массив нумеруются с единицы,
            начиная с разряда единиц, т.е. цифра из разряда единиц — элемент массива с номером один, цифра из
            разряда десятков — элемент массива с номером два и т.д. Определим для работы с "длинными" неотрицательными
            числами тип данных:
        </p>

        <pre>
    Const MNax = 2000;
    Type Digit = 0..9;
        DlChislo = Array[1..Nmax] Of Digit;
    </pre>

        <p class="paragraph_2">
            Для решения поставленной задачи необходимо уметь выполнять следующие действия:
        </p>

        <ol class="ol">
            <li>
                ввод "длинного" числа;
            </li>
            <li>
                собственно умножение двух "длинных" чисел;
            </li>
            <li>
                вывод "длинного" числа;
            </li>
            <li>
                определение количества цифр в записи числа.
            </li>
        </ol>

        <p class="text">
            Каждую из подзадач реализуем в виде отдельной подпрограммы. Начнем с ввода. Ввести большое число целесообразно
            в виде строки, а в дальнейшем преобразовать в массив цифр. В процедуре учтен указанный выше способ размещения
            "длинного" числа в массиве, т.е. с точки зрения пользователя число записывается как бы в обратном порядке.
        </p>

        <pre>
    {Процедура преобразования длинного числа, записанного
     в виде строки, в массив цифр; переменная OK принимает значение True,
     если в записи числа нет посторонних символов, отличных от десятичных
     цифр, иначе — false}
     Procedure Translate(S : String; Var A : DlChislo; Var OK : Boolean);
     Var I : Word;
     Begin
         Zero(A); I := Length(S); OK := True;
         While (I >= 1) And OK Do
          Begin
              If S[I] In ['0'..'9']
              Then A[Length(S)- I + 1]:= Ord(S[I]) - 48
              Else OK := False; I := I - 1
          End
     End;
    </pre>

        <p>
            В процедуре вызывается подпрограмма <span style="font-family: 'Courier New', monospace;">Zero(A)</span>,
            назначение которой — запись нуля в каждый разряд длинного числа. Вот текст этой процедуры:
        </p>

        <pre>
    {Процедура обнуления длинного числа}
    Procedure Zero(Var A : DlChislo);
    Var I : Integer;
    Begin
        For I := 1 To NMax Do A[I] := 0;
    End;
    </pre>

        <p>
            Таким образом, длинное число записано в массив, где впереди (в качестве элементов с большими номерами) стоят
            незначащие нули. При выполнении действий и выводе ответа они не учитываются.
        </p>

        <p>
            Сейчас разработаем функцию определения количества значащих цифр в записи числа, поскольку она потребуется
            при реализации подпрограммы умножения.
        </p>

        <pre>
    {Функция определения количества цифр в записи длинного числа}
     Function Dlina(C : DlChislo) : Integer;
     Var I : Integer;
     Begin
       I := NMax;
       While (I > 1) And (C[I] = 0) Do I := I - 1;
       Dlina := I
     End;
    </pre>

        <p>
            При ее разработке было использовано следующее соображение: если число не равно нулю, то количество цифр
            в его записи равно номеру первой цифры, отличной от нуля, если просмотр числа осуществляется от старшего
            разряда к младшему. Если же длинное число равно нулю, то получается, что количество цифр в его записи
            равно одной, что и требовалось.
        </p>

        <p>
            Ну и, наконец, главная процедура, ради которой и была проделана вся предшествующая работа. При составлении
            алгоритма используется идея умножения "столбиком", хотя в нашем варианте сложение выполняется не по окончанию
            умножения, а по ходу его, т.е. перемножив очередные цифры, сразу же добавляем результирующую цифру в нужный
            разряд и формируем перенос в следующий разряд.
        </p>

        <pre>
    {Процедура умножения длинных чисел.
     A, B — множители, C — произведение}
     Procedure Multiplication(A, B : DlChislo; Var C : DlChislo);
     Var I, J : Integer; P : Digit; VspRez : 0..99;
      Begin
        Zero(C);
        For I := 1 To Dlina(A) Do {Цикл по количеству цифр
                                   в первом числе}
         Begin
            P := 0; {Первоначально перенос равен нулю}
            For J := 1 To Dlina(B) Do {Цикл по количеству цифр
                                       во втором числе}
             Begin
               VspRez := A[I] * B[J] + P + C[I + J - 1];
               C[I + J - 1] := VspRez Mod 10; {Очередное значение цифры в
                                               разряде I + J - 1}
               P := VspRez Div 10 {Перенос в следующий разряд}
             End;
           C[I + J] := P {последний перенос может быть отличен от нуля,
                          запишем его в пока ещё свободный разряд}
         End
      End;
    </pre>

        <!-- Физическое форматирование <b> и <i> -->
        <p>
            Сейчас приведем листинг программы <b><i>целиком</i></b>.
        </p>

        <pre>
    Program DlUmn;
    Const NMax = 2000;
    Type Digit = 0..9; DlChislo = Array[1..Nmax] Of Digit;
    Var S : String;
        M, N, R, F : DlChislo;
        I, MaxF : Word;
        Logic : Boolean;
    {Процедура обнуления длинного числа}
    Procedure Zero(Var A : DlChislo);
    Var I : Integer;
      Begin
        For I := 1 To NMax Do A[I] := 0;
      End;
    {Функция определения количества цифр в записи длинного числа}
    Function Dlina(C : DlChislo) : Integer;
    Var I : Integer;
     Begin
       I := NMax;
       While (I > 1) And (C[I] = 0) Do I := I - 1;
       Dlina := I
     End;
    {Процедура печати длинного числа}
    Procedure Print(A : DlChislo);
    Var I : Integer;
     Begin
        For I := Dlina(A) DownTo 1 Do Write(A[I] : 1);
        WriteLn
     End;
    {Процедура преобразования длинного числа в массив цифр}
    Procedure Translate(S : String; Var A : DlChislo;
                        Var OK : Boolean);
    Var I : Word;
     Begin
       Zero(A); I := Length(S); OK := True;
       While (I >= 1) And OK Do
       Begin
          If S[I] In ['0'..'9']
          Then A[Length(S) - I+ 1] := Ord(S[I]) - 48
          Else OK := False;
          I := I - 1
       End
     End;
    Procedure Multiplication(A, B : DlChislo; Var C : DlChislo);
    Var I, J : Integer; P : Digit; VspRez : 0..99;
     Begin
      Zero(C);
      For I := 1 To Dlina(A) Do
      Begin P := 0;
            For J := 1 To Dlina(B) Do
            Begin
              VspRez := A[I] * B[J] + P + C[I + J - 1];
            C[I + J - 1] := VspRez Mod 10;
            P := VspRez Div 10
          End;
            C[I + J] := P
       End
     End;
    {Основная программа}
    Begin
       Repeat {повторяем ввод, пока число не будет введено правильно}
         Write('Введите первый множитель: ');
         ReadLn(S); Translate(S, M, Logic)
       Until Logic;
       Repeat
         Write('Введите второй множитель: ');
         ReadLn(S); Translate(S, N, Logic)
       Until Logic;
       Multiplication(M, N, R); Print(R)
    End.
    </pre>

        <p>
            В приведенном листинге <b>Print</b> — процедура вывода длинного числа. Предоставим читателю самостоятельно
            разобраться в алгоритме ее работы.
        </p>

        <p>
            Вернемся к вычислению факториала. Используя разработанные подпрограммы, определим, значение факториала какого
            максимального числа можно разместить в памяти при таком представлении длинных чисел.
        </p>

        <p>
            Вот измененный фрагмент основной программы, решающий поставленную задачу.
        </p>

        <pre>
    Begin
    MaxF := 810;
    Zero(F);
    F[1] := 1;
    For I := 1 To MaxF Do
     Begin
       Str(I, S); {преобразование числа I к строковому типу S}
       Translate(S, M, Logic);
       Multiplication(F, M, F);
       Print(F);
       WriteLn('Факториал числа ', I : 4, ' содержит ', Dlina(F), ' цифр.')
     End
    End.
    </pre>

        <h2 id="conclusion">
            Заключение
        </h2>

        <p>
            Расчеты показали, что можно вычислять факториалы до значения 810! включительно, в записи которого 1999 цифр.
            Далее вновь возникает переполнение. Расчеты по программе продолжаются около 5 минут
            (IBM PC с процессором Pentium–100).
        </p>

        <!-- Логическое форматирование <cite> -->
        <p class="paragraph_1">
            Ниже будет предложен список задач для самостоятельного выполнения. Из них, по мнению автора, наибольшую
            сложность представляют реализации алгоритмов деления одного длинного числа на другое и извлечение квадратного
            корня. Алгоритм извлечения квадратного корня подробно описан в справочнике <cite>В.А. Гусева и А.Г. Мордковича</cite> [7].
            В некоторых случаях составленные программы могут выступать как подпрограммы при разработке алгоритмов решения
            других, более сложных (как в примере с факториалом), задач. Кроме авторских задач и задач из списка литературы
            здесь приведены задания из олимпиад школьников по программированию, проводившихся в Пермской области
            в 1989-99&nbsp;гг.
        </p>

        <h1>
            Посмотри и отдохни!
        </h1>
        <iframe class="day" width="900" height="506" src="https://www.youtube.com/embed/nxD-HnxegTk" frameborder="0" allowfullscreen></iframe>
        <iframe class="night" width="900" height="506" src="https://www.youtube.com/embed/CtcvjaOuhNU" frameborder="0" allowfullscreen></iframe>

        <h2 id="tasks">
            Задачи для самостоятельного решения
        </h2>

        <ol>
            <li>
                Составить программу сравнения двух многозначных чисел (количество знаков в записи чисел более&nbsp;20).
            </li>
            <li>
                Составить программу, суммирующую два натуральных многозначных числа с количеством знаков более&nbsp;20.
            </li>
            <li>
                Составить программу вычисления степени <i>a<sup>n</sup></i>, если <i>a</i> &gt;
                MaxInt, <i>n</i>&nbsp;&gt;&nbsp;10.
            </li>
            <li>
                Составить программу вычисления числа 2<sup>64</sup> – 1, в результате сохранить все цифры.
            </li>
            <li>
                Составить программу вычисления 100!.
            </li>
            <li>
                Составить программу извлечения точного квадратного корня из <i>n</i>-разрядного числа (<i>n&nbsp;</i>&gt;&nbsp;40).
            </li>
            <li>
                Составить программу вычисления точного значения <i>n</i>!, где <i>n</i> &gt; 12.
            </li>
            <li>
                Составить программу вычисления точного значения <i>n<sup>n</sup></i>, где <i>n</i> &gt; 10.
            </li>
            <li>
                Составить программу деления числа <i>a</i> на число <i>b</i>, если <i>a, b</i> — многозначные числа.
            </li>
            <li>
                Вычислить 100! + 2<sup>100</sup>.
            </li>
            <li>
                Вычислить 100! – 2<sup>100</sup>.
            </li>
            <li>
                Вычислить 7<sup>123</sup>.
            </li>
            <li>
                Встречаются ли среди цифр числа 2<sup>11213</sup> – 1 две подряд идущие девятки?
            </li>
            <li>
                Вычислить 2<sup>–200</sup>.
            </li>
            <li>
                Составить программу нахождения частного и остатка от деления <i>m</i>-значного числа на <i>n</i>–значное
                (<i>m, n</i> &gt; 20).
            </li>
            <li>
                Выяснить, какое из чисел <i>a<sup>m</sup></i>, <i>b<sup>n</sup></i> больше и на сколько
                (<i>a, b</i>&nbsp;&lt;=&nbsp;40000; <i>m</i>, <i>n</i>&nbsp;&lt;=&nbsp;10).
            </li>
            <li>
                Найти <i>n</i> знаков в десятичной записи квадратного корня из целого числа <i>m</i> (<i>n</i> >= 50).
            </li>
            <li>
                Найти количество делителей <i>n</i>-значного натурального числа (<i>n</i> &gt; 20).
            </li>
            <li>
                Вычислить точное значение (<i>n</i>!)! (<i>n</i>&nbsp;&gt;=&nbsp;3).
            </li>
            <li>
                Составить программу вычисления точного значения суммы 1! + 2! + 3! + ... + <i>n</i>!
                при <i>n&nbsp;</i>&gt;&nbsp;10.
            </li>
            <li>
                Составить программу вычисления точного значения суммы дробей
                <br>
                <img src="img/image11.gif">
                <br>
                при <i>n</i> &gt; 10. Ответ должен быть представлен в виде несократимой
                дроби <i>p</i> / <i>Q</i>, где <i>p</i>, <i>Q</i> — натуральные числа.
            </li>
            <li>
                Вычислить точное значение (<i>n<sup>n</sup></i>)! при <i>n</i>&nbsp;&gt;=&nbsp;3.
            </li>
            <li>
                Составить программу вычисления точного значения суммы первых <i>n</i> членов последовательности 1,
                <i>k</i>, <i>k</i><sup>2</sup>, <i>k</i><sup>3</sup>, ..., <i>k<sup>n</sup></i> (<i>n</i> &gt; MaxInt).
                <br>
                <u>Указание:</u> используйте формулу суммы <i>n</i> членов геометрической прогрессии.
            </li>
            <li>
                Составить программу вычисления точного значения суммы первых <i>n</i> членов последовательности чисел, кратных
                данному натуральному числу <i>k</i> (<i>n&nbsp;</i>&gt;&nbsp;MaxInt). <u>Указание: </u>используйте формулу
                суммы <i>n</i> членов арифметической прогрессии.
            </li>
            <li>
                Вычислить точное значение суммы 1<sup>2 </sup>+ 2<sup>2 </sup>+ 3<sup>2 </sup>+ … + <i>n</i><sup>2</sup>
                (<i>n</i>&nbsp;&gt;=&nbsp;20000).
            </li>
            <li>
                Вычислить точное значение суммы 1<sup><i>n</i></sup> + 2<sup><i>n</i></sup> + 3<sup><i>n</i></sup> + ... +
                <i>n</i><sup><i>n</i></sup> (<i>n</i>&nbsp;&gt;=&nbsp;10).
            </li>
            <li>
                Найти первое простое число, которое больше 10<sup>11</sup>.
            </li>
            <li>
                Составить программу вычисления точного значения многочлена
                <i>a<sub>n</sub>x<sup>n</sup></i> + <i>a</i><sub><i>n</i> - 1</sub><i>x</i><sup><i>n</i> - 1</sup> + ...
                + <i>a</i><sub>1</sub><i>x</i> + <i>a</i><sub>0</sub>,
                где <i>a<sub>i</sub></i>&nbsp;и&nbsp;<i>x</i> — целые числа больше 10<sup>11</sup>.
            </li>
            <li>
                Найти наибольший общий делитель и наименьшее общее кратное чисел <i>m</i> и <i>n</i>
                (<i>m, n</i>&nbsp;&gt;=&nbsp;10<sup>11</sup>).
            </li>
            <li>
                Проверить, являются ли числа <i>m</i> и <i>n</i> (<i>m, n</i>&nbsp;>=&nbsp;10<sup>11</sup>) взаимно простыми.
            </li>
            <li>
                Докажите, что число 2<sup>19936</sup> * (2<sup>19937</sup> – 1) является совершенным, т.е. равно сумме всех
                своих делителей, кроме самого себя.
            </li>
            <li>
                "<i>Вращающееся число"</i>. Написать программу, которая находит число, обладающее следующими свойствами:
                <br>
                1) число оканчивается на 5;
                <br>
                2) при умножении его на 5 образуется новое число, которое может быть получено из исходного вычеркиванием
                цифры 5 на конце и переписыванием ее в начало числа.
            </li>
            <li>Дана последовательность, заданная рекуррентной формулой
                <br>
                <i>a</i><sub><i>n</i> + 1</sub> = 7<i>a<sub>n</sub></i> mod 2023, <i>a</i><sub>1</sub> = 1,
                <br>
                где <i>x</i> mod <i>y</i> означает остаток от деления <i>x</i> на <i>y</i>. Написать программу,
                вычисляющую <i>a<sub>n</sub></i> при 1&nbsp;&lt;=&nbsp;<i>n</i>&nbsp;&lt;=&nbsp;1000000000000000000000.
            </li>
            <li>Дана последовательность
                <br>
                <img src="img/image15.gif" width="219" height="51">
                <br>
                Написать программу, находящую точное значение <i>a<sub>n</sub></i>
                при 1&nbsp;&lt;=&nbsp;<i>n</i>&nbsp;&lt;=&nbsp;150.
                <br>
                Пример. При <i>n</i> = 58 получаем <i>a<sub>n</sub></i> = 10359022039470231387111424.
            </li>
            <li>
                Напишите программу перевода многозначного числа (с количеством знаков больше 20) в системы счисления с
                основанием два, восемь, шестнадцать.
            </li>
            <li>
                Разложить на простые множители натуральное число с количеством знаков более 11.
            </li>
            <li>
                <i>Умножение периодической дроби.</i>
                <br>
                Задана некоторая положительная правильная периодическая дробь <i>Q</i> и
                натуральное число <i>N</i>. Числа<i> Q</i> и <i>N</i> таковы, что количество цифр, используемых для их описания,
                не превосходит 100. При изображении дроби <i>Q</i> периодическая часть заключается в круглые скобки.
                <br>
                Требуется написать программу, которая определяет результат умножения <i>Q</i> на <i>N</i>, то есть
                непериодическую часть и минимальный период числа <i>Q</i>&nbsp;*&nbsp;<i>N</i>.
                <br>
                В случае получения результата умножения в виде конечной дроби скобки опускаются.
            </li>
        </ol>

        <p>
            <u>Пример работы правильной программы</u>
            <br>
            Введите периодическую дробь: 0.1(6)
            <br>
            Введите натуральное число: 2
            <br>
            Ответ: 0.(3)
        </p>

        <hr class="hr_2">

        <h2 id="literature">
            Список использованной литературы
        </h2>

        <ol>
            <li>
                Абрамов С.А., Гнездилова Г.Г., Капустина Е.Н., Селюн М.И. Задачи по программированию. М.: Наука, 1988.
            </li>
            <li>
                Олимпиады по информатике. Задачи и решения. Методические рекомендации для учителей и учащихся школ. Красноярск,
                1991.
            </li>
            <li>
                Пильщиков В.Н. Сборник упражнений по языку Паскаль. М.: Наука, 1989.
            </li>
            <li>
                Касаткин В.Н. Информация. Алгоритмы. ЭВМ. М.: Просвещение, 1991.
            </li>
            <li>
                Хонсбергер Р. Математические изюминки. М.: Наука, 1992.
            </li>
            <li>
                Семакин И.Г., Шестаков А.П. Лекции по программированию. Пермь: изд-во ПГУ, 1998.
            </li>
            <li>
                Гусев В.А., Мордкович А.Г. Математика. Справочные материалы. М.: Просвещение, 1990.
            </li>
            <li>
                Гладков В.П. Курс лабораторных работ по программированию. Пермь: изд-во ПГТУ, 1998.
            </li>
        </ol>

        <h2 id="analogy">
            Сайты аналогичной тематики
        </h2>
        <ol>
            <li>
                <a href="http://www.programmersforum.ru/showthread.php?t=188800" target="_blank">
                    Паскаль. Длинная арифметика (форум)
                </a>
            </li>
            <li>
                <a href="http://forum.pascal.net.ru/index.php?showtopic=2428" target="_blank">
                    "Все о Паскале". Длинная арифметика (форум)
                </a>
            </li>
            <li>
                <a href="http://www.cyberforum.ru/pascalabc/thread682897.html" target="_blank">
                    Киберфорум. Паскаль ABC. Длинная арифметика (форум)
                </a>
            </li>
        </ol>

        <table>
            <tr>
                <th>
                    Слово
                </th>
                <th>
                    Частота
                </th>
            </tr>
            <tr>
                <td>
                    программа
                </td>
                <td>
                    24
                </td>
            </tr>
            <tr>
                <td>
                    цифра
                </td>
                <td>
                    23
                </td>
            </tr>
            <tr>
                <td>
                    при
                </td>
                <td>
                    19
                </td>
            </tr>
        </table>

        <img class="day" src="img/img1.png" style="width: 900px">

        <img class="night" src="img/img4.png" style="width: 400px; margin: 0 auto;">

        <hr>

        <p>
            &copy; Шестаков А.П., 1996-1999
        </p>
    </div>

</body>
</html>